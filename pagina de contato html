<?php

function stressTest($level) {
    switch ($level) {
        case 1:
            // Nível Normal: Pequeno processamento de CPU
            echo "Nível Normal (1): Iniciando teste leve.\n";
            for ($i = 0; $i < 100000; $i++) {
                $result = sqrt($i); // Operação leve de cálculo
            }
            echo "Nível Normal (1): Teste concluído.\n";
            break;

        case 2:
            // Nível Médio: Usa processamento mais intenso
            echo "Nível Médio (2): Iniciando teste médio.\n";
            for ($i = 0; $i < 100000000; $i++) {
                $result = sqrt($i) * log($i + 1); // Operação matemática mais repetida e mais pesada
            }
            echo "Nível Médio (2): Teste concluído.\n";
            break;

        case 3:
            // Nível Extremo: Usa processamento em paralelo com alta intensidade e sem limitações
            echo "Nível Extremo (3): Iniciando teste extremo.\n";
            $processCount = 8; // Mais processos para maior carga
            $pids = [];

            // Cria processos paralelos para sobrecarregar ao máximo a máquina
            for ($p = 0; $p < $processCount; $p++) {
                $pid = pcntl_fork();
                if ($pid == -1) {
                    die('Erro ao criar processo');
                } elseif ($pid) {
                    $pids[] = $pid; // Processo pai
                } else {
                    // Processo filho
                    for ($i = 0; $i < 1000000000; $i++) {
                        $result = sqrt($i) * log($i + 1) * rand(); // Operação intensiva e complexa
                    }
                    exit(0); // Processo filho termina aqui
                }
            }

            // Espera os processos filhos terminarem
            foreach ($pids as $pid) {
                pcntl_waitpid($pid, $status);
            }

            echo "Nível Extremo (3): Teste concluído.\n";
            break;

        default:
            echo "Nível inválido. Escolha entre 1, 2 ou 3.\n";
    }
}

// Escolha o nível de estresse da CPU: 1 = leve, 2 = médio, 3 = extremo
$level = intval($argv[1] ?? 1);
stressTest($level);

?>
